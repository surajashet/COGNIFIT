<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cognifit | Food Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: #ffffff;
    }
    
    .card-shadow {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    .upload-area {
      border: 2px dashed #e2e8f0;
      transition: all 0.3s ease;
    }
    
    .upload-area:hover {
      border-color: #ABC85F;
      background-color: #f8fafc;
    }
    
    .btn-red {
      background-color: #A3391A;
      color: white;
    }
    
    .btn-red:hover {
      background-color: #8a3016;
    }
    
    .text-green {
      color: #ABC85F;
    }
    
    .border-green {
      border-color: #ABC85F;
    }
    
    .focus-green:focus {
      border-color: #ABC85F;
      ring-color: #ABC85F;
    }
  </style>
</head>

<body class="text-gray-800 min-h-screen">
  <div class="max-w-3xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-10">
      <h1 class="text-3xl font-bold mb-3 text-green">üçΩÔ∏è Cognifit Food Tracker</h1>
    </div>

    <!-- Upload Section -->
    <div class="bg-white rounded-2xl card-shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4 text-green">Upload Food Image</h2>
      
      <input id="fileInput" type="file" accept="image/*" class="block mb-4 w-full text-sm text-gray-500
        file:mr-4 file:py-2 file:px-4
        file:rounded-full file:border-0
        file:text-sm file:font-semibold
        file:bg-green-50 file:text-green-700
        hover:file:bg-green-100" />

      <!-- 3-column Row -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
        <!-- Amount -->
        <div class="flex items-center gap-2 w-full sm:w-1/3">
          <label class="text-sm text-gray-600 whitespace-nowrap">Amount:</label>
          <input id="gramsInputImage" type="number" value="100"
            class="w-full border border-gray-300 rounded-lg p-2 text-center focus:ring-2 focus:ring-green-400 focus-green" />
        </div>

        <!-- Unit -->
        <div class="flex items-center gap-2 w-full sm:w-1/3">
          <label class="text-sm text-gray-600 whitespace-nowrap">Unit:</label>
          <select id="unitImage"
            class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-green-400 focus-green">
            <option value="grams">grams</option>
            <option value="ml">ml</option>
            <option value="cup">cup</option>
            <option value="plate">plate</option>
            <option value="tbsp">tbsp</option>
          </select>
        </div>

        <!-- Quantity -->
        <div class="flex items-center gap-2 w-full sm:w-1/3">
          <label class="text-sm text-gray-600 whitespace-nowrap">Quantity:</label>
          <div class="flex items-center border border-gray-300 rounded-lg overflow-hidden">
            <button id="decreaseQtyImage"
              class="bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 transition">‚àí</button>
            <input id="quantityImage" type="number" value="1" min="1"
              class="w-16 text-center outline-none border-none" />
            <button id="increaseQtyImage"
              class="bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 transition">+</button>
          </div>
        </div>
      </div>

      <button id="predictButton"
        class="w-full btn-red font-medium py-3 rounded-lg transition flex items-center justify-center gap-2">
        <i class="fas fa-search"></i> Predict Food
      </button>
    </div>

    <!-- Manual Entry -->
    <div class="bg-white rounded-2xl card-shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4 text-green">Manual Food Entry</h2>
      
      <input id="manualFoodInput" type="text" placeholder="Enter food name (e.g., apple)"
        class="border border-gray-300 rounded p-3 w-full mb-4 focus:ring-2 focus:ring-green-400 focus-green" />

      <!-- 3-column Row -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
        <!-- Amount -->
        <div class="flex items-center gap-2 w-full sm:w-1/3">
          <label class="text-sm text-gray-600 whitespace-nowrap">Amount:</label>
          <input id="gramsInputManual" type="number" value="100"
            class="w-full border border-gray-300 rounded-lg p-2 text-center focus:ring-2 focus:ring-green-400 focus-green" />
        </div>

        <!-- Unit -->
        <div class="flex items-center gap-2 w-full sm:w-1/3">
          <label class="text-sm text-gray-600 whitespace-nowrap">Unit:</label>
          <select id="unitManual"
            class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-green-400 focus-green">
            <option value="grams">grams</option>
            <option value="ml">ml</option>
            <option value="cup">cup</option>
            <option value="plate">plate</option>
            <option value="tbsp">tbsp</option>
          </select>
        </div>

        <!-- Quantity -->
        <div class="flex items-center gap-2 w-full sm:w-1/3">
          <label class="text-sm text-gray-600 whitespace-nowrap">Quantity:</label>
          <div class="flex items-center border border-gray-300 rounded-lg overflow-hidden">
            <button id="decreaseQtyManual"
              class="bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 transition">‚àí</button>
            <input id="quantityManual" type="number" value="1" min="1"
              class="w-16 text-center outline-none border-none" />
            <button id="increaseQtyManual"
              class="bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 transition">+</button>
          </div>
        </div>
      </div>

      <button id="manualLookupButton"
        class="w-full btn-red font-medium py-3 rounded-lg transition flex items-center justify-center gap-2">
        <i class="fas fa-chart-bar"></i> Lookup Nutrition
      </button>
    </div>

    <!-- Result Display -->
    <div id="resultCard" class="hidden bg-white rounded-2xl card-shadow p-6 mb-6 transition">
      <h3 class="text-2xl font-semibold text-center mb-6 text-green" id="predictedFood"></h3>

      <div class="grid grid-cols-2 gap-4 text-center mb-6">
        <div class="bg-green-50 rounded-lg p-4">
          <p class="text-sm text-gray-600">Calories</p>
          <p class="text-lg font-semibold" id="calories">0</p>
        </div>
        <div class="bg-green-50 rounded-lg p-4">
          <p class="text-sm text-gray-600">Protein</p>
          <p class="text-lg font-semibold" id="protein">0</p>
        </div>
        <div class="bg-green-50 rounded-lg p-4">
          <p class="text-sm text-gray-600">Carbs</p>
          <p class="text-lg font-semibold" id="carbs">0</p>
        </div>
        <div class="bg-green-50 rounded-lg p-4">
          <p class="text-sm text-gray-600">Fat</p>
          <p class="text-lg font-semibold" id="fat">0</p>
        </div>
      </div>

      <div class="text-center">
        <button id="saveButton"
          class="btn-red px-5 py-3 rounded-lg transition font-medium">
          <i class="fas fa-check mr-2"></i> Save Entry
        </button>
      </div>
    </div>
  </div>

  <script>
    const predictButton = document.getElementById("predictButton");
    const manualLookupButton = document.getElementById("manualLookupButton");
    const saveButton = document.getElementById("saveButton");

    const unitToGrams = { grams: 1, ml: 1, cup: 240, plate: 350, tbsp: 15 };

    // Quantity + buttons
    [["increaseQtyImage", "decreaseQtyImage", "quantityImage"],
     ["increaseQtyManual", "decreaseQtyManual", "quantityManual"]]
      .forEach(([incId, decId, inputId]) => {
        const inc = document.getElementById(incId);
        const dec = document.getElementById(decId);
        const input = document.getElementById(inputId);
        inc.addEventListener("click", () => input.value = parseInt(input.value || 1) + 1);
        dec.addEventListener("click", () => {
          if (parseInt(input.value) > 1) input.value = parseInt(input.value) - 1;
        });
      });

    // --- Predict from Image ---
    predictButton.addEventListener("click", async () => {
      const fileInput = document.getElementById("fileInput");
      const amount = parseFloat(document.getElementById("gramsInputImage").value) || 100;
      const quantity = parseFloat(document.getElementById("quantityImage").value) || 1;
      const unit = document.getElementById("unitImage").value;
      const totalGrams = amount * (unitToGrams[unit] || 1) * quantity; // ‚úÖ FIXED

      if (!fileInput.files.length) return alert("Please upload an image.");

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      formData.append("grams", totalGrams);

      const res = await fetch("http://127.0.0.1:8000/predict", { method: "POST", body: formData });
      const data = await res.json();
      if (!res.ok) return alert(data.detail || "Error predicting food.");

      displayResult(data.predicted_food, data.nutrition_info, totalGrams, quantity, unit);
    });

    // --- Manual Lookup ---
    manualLookupButton.addEventListener("click", async () => {
      const foodInput = document.getElementById("manualFoodInput").value.trim();
      const amount = parseFloat(document.getElementById("gramsInputManual").value) || 100;
      const quantity = parseFloat(document.getElementById("quantityManual").value) || 1;
      const unit = document.getElementById("unitManual").value;
      const totalGrams = amount * (unitToGrams[unit] || 1) * quantity; // ‚úÖ FIXED

      if (!foodInput) return alert("Enter a food name first.");

      const res = await fetch("http://127.0.0.1:8000/manual-lookup", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ food_name: foodInput, grams: totalGrams }),
      });

      const data = await res.json();
      if (!res.ok) return alert(data.detail || "Error in manual lookup.");

      displayResult(data.name, data, totalGrams, quantity, unit);
    });

    // --- Show Result ---
    function displayResult(foodName, nutrition, grams, quantity, unit) {
      document.getElementById("resultCard").classList.remove("hidden");
      document.getElementById("predictedFood").textContent =
        `${foodName} (${quantity} ${unit} ‚âà ${grams.toFixed(1)}g)`;

      document.getElementById("calories").textContent = nutrition.calories.toFixed(2);
      document.getElementById("protein").textContent = nutrition.protein.toFixed(2);
      document.getElementById("carbs").textContent = nutrition.carbs.toFixed(2);
      document.getElementById("fat").textContent = nutrition.fat.toFixed(2);
    }

    // --- Save Entry ---
    saveButton.addEventListener("click", () => {
      alert("‚úÖ Food entry saved successfully!");
    });
  </script>
</body>
</html>
